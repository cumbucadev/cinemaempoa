{% extends 'base.html' %} {% block header %}
<h1>{% block title %}Criar sessão{% endblock %}</h1>
{% endblock %}
{% block content %}
    <form method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label class="form-label" for="title">Cinema</label>
        <select class="form-select" id="cinema_id" name="cinema_id">
        <option {% if not request.form['cinema_id'] %} selected {% endif %}>Selecione uma sala</option>
        {% for cinema in cinemas %}
            <option value="{{ cinema.id }}"{% if request.form['cinema_id'] == cinema.id|string %} selected {% endif %}>{{ cinema.name }}</option>
        {% endfor %}
        </select>
    </div>
    <div class="mb-3" id="screenings">
        <p>Exibições</p>
        {% if received_dates|length %}
        {% for received_date in received_dates %}
            <div class="mb-2">
            <input class="form-control mb-1" type="datetime-local" name="screening_dates" value="{{received_date}}" min="2023-01-01T00:00" max="{{max_year}}-12-31T00:00" />
            <button onclick="removeScreening(this)"  type="button" class="btn btn-sm">Remover</button>
            </div>
        {% endfor %}
        {% else %}
        <div class="mb-2">
            <input class="form-control mb-1" type="datetime-local" name="screening_dates" value="{{current_date}}T19:00" min="2023-01-01T00:00" max="{{max_year}}-12-31T00:00" />
            <button onclick="removeScreening(this)"  type="button" class="btn btn-sm">Remover</button>
        </div>
        {% endif %}
    </div>
    <div class="mb-3">
        <button type="button" id="add-screening-btn" class="btn btn-secondary">Outra exibição</button>
    </div>
    <div class="mb-3">
        <label class="form-label" for="title">Title</label>
        <input autocomplete="off" class="form-control" name="movie_title" id="title" value="{{ request.form['movie_title'] }}" oninput="fetchSimilarTitles()" required>
    </div>
    <ul class="mb-3" class="" id="similar_movies">
    </ul>
    <div class="mb-3">
        <div class="d-flex mb-2 align-items-center">
            <label for="movie_poster" class="form-label mb-0 me-3">Imagem do filme</label>
            <button type="button" id="gen-alt-btn"
            class="btn btn-secondary d-none"
            onclick="fetchImageAltText(event)"
            >
                Gerar alt text
            </button>
        </div>
        <input
            class="form-control"
            name="movie_poster"
            type="file"
            id="movie_poster"
            onchange="verifyFileSize(this)" accept="image/*"
        />
        <p class="form-text">
            <span id="file-limit-label"></span>
            <span class="text-danger d-block" id="errorMessage"></span>
        </p>
    </div>
    <div class="mb-3">
        <label class="form-label" for="image_alt">Descrição do poster (texto alternativo)</label>
        <textarea
            placeholder="Descreva a imagem adicionada acima"
            class="form-control"
            name="image_alt"
            id="image_alt"
            >{{ request.form['image_alt'] }}</textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">Status do cadastro</label>
        <div class="form-check">
        <input class="form-check-input" type="radio" value="draft" name="status" id="status-draft">
        <label class="form-check-label" for="status-draft">
            Salvar rascunho
        </label>
        </div>
        <div class="form-check">
        <input class="form-check-input" type="radio" value="published" name="status" id="status-published" checked>
        <label class="form-check-label" for="status-published">
            Publicar
        </label>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label" for="screening-description">Body</label>
        <div class="grow-wrap">
        <textarea
            class="form-control"
            name="description"
            id="screening-description"
            >{{ request.form['description'] }}</textarea>
        </div>
    </div>
    <div class="container mb-3 pb-3">
        <input class="btn btn-primary" type="submit" value="Save">
        <a id="back-btn" class="btn btn-secondary" href="{{ url_for('screening.index') }}">Voltar</a>
    </div>
    </form>
{%endblock %}
{% include 'screening/form_js.html' %}